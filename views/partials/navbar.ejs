<nav class="navbar" style="position: relative; z-index: 1000">
 <a href="/" class="nav-brand">
  <img
      src="docs/S_Arrows_Yellow_transparent.png"
      alt="SkillSwap logo"
      style="margin-right: 8px"
      width="24"
      height="24"
    />
    SkillSwap
  </a>

  <% if (typeof user !== 'undefined' && user) { %>
  <div class="nav-links">
    <a href="/" class="nav-link">Dashboard</a>
    <a href="/my_sessions" class="nav-link">Sessions</a>
    <a href="/messages" class="nav-link">Messages</a>

    <% if (user.isAdmin) { %>
    <a href="/admin" class="nav-link" style="color: #ce6060">Admin</a>
    <% } %>

    <div style="position: relative; margin-left: 15px">
      <div
        onclick="toggleUserMenu()"
        tabindex="0"
        onkeydown="if(event.key === 'Enter') toggleUserMenu()"
        style="
          cursor: pointer;
          display: flex;
          align-items: center;
          gap: 8px;
          padding: 5px;
          border-radius: 6px;
          transition: background 0.2s;
        "
      >
        <span style="font-size: 0.9em; font-weight: bold; color: white"
          ><%= user.name %></span
        >
        <img
          src="https://api.dicebear.com/9.x/<%= user.avatarStyle || 'bottts' %>/svg?seed=<%= user.name %>"
          class="nav-avatar"
          alt="Avatar"
          style="
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 1px solid #ccc;
          "
        />
        <span style="font-size: 0.8em; color: #ccc">‚ñº</span>
      </div>

      <div
        id="userDropdown"
        style="
          display: none;
          position: absolute;
          right: 0;
          top: 120%;
          background: white;
          color: #333;
          min-width: 220px;
          border-radius: 8px;
          box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
          border: 1px solid #eee;
          overflow: hidden;
        "
      >
        <div
          style="
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            background: #f9fafb;
          "
        >
          <div style="font-weight: bold; font-size: 0.9rem">
            <%= user.name %>
          </div>
        </div>

        <a href="/profile/view/<%= user.id %>" class="menu-item" color="white">
          üë§ My Profile
        </a>

        <div
          onclick="toggleColorblind()"
          class="menu-item"
          style="
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
          "
        >
          <span>üëÅÔ∏è High Contrast</span>
          <input type="checkbox" id="cbToggle" style="pointer-events: none" />
        </div>

        <div style="border-top: 1px solid #eee"></div>

        <a
          href="#"
          onclick="handleLogout()"
          class="menu-item"
          style="color: #ef4444"
        >
          üö™ Log Out
        </a>
      </div>
    </div>
  </div>

  <% } else { %>
  <div class="nav-links">
    <a href="/login" class="nav-link">Log In</a>
    <a
      href="/register"
      class="nav-link"
      style="
        background-color: var(--primary-color, #2563eb);
        color: white;
        padding: 8px 15px;
        border-radius: 6px;
      "
      >Sign Up</a
    >
  </div>
  <% } %>
</nav>

<style>
  .menu-item {
    display: block;
    padding: 10px 15px;
    text-decoration: none;
    color: #333;
    font-size: 0.9rem;
    transition: background 0.1s;
  }
  .menu-item:hover {
    background: #f3f4f6;
  }

  body.high-contrast-mode {
    filter: contrast(1.5) saturate(0.8);
    background-color: #fff !important;
  }
  body.high-contrast-mode nav,
  body.high-contrast-mode .navbar {
    background: #000 !important;
    border-bottom: 2px solid yellow;
  }
  body.high-contrast-mode a {
    text-decoration: underline;
  }
</style>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
  function toggleUserMenu() {
    const menu = document.getElementById("userDropdown");
    menu.style.display = menu.style.display === "block" ? "none" : "block";
  }

  document.addEventListener("click", function (event) {
    const dropdown = document.getElementById("userDropdown");
    const trigger = event.target.closest('[onclick="toggleUserMenu()"]');
    const insideMenu = event.target.closest("#userDropdown");

    if (!trigger && !insideMenu && dropdown) {
      dropdown.style.display = "none";
    }
  });

  async function handleLogout() {
    if (!confirm("Are you sure you want to log out?")) return;
    try {
      const response = await axios.post("/api/logout");
      if (response.status === 200) window.location.href = "/";
    } catch (error) {
      console.error("Logout Failed:", error);
      alert("Logout failed.");
    }
  }

  function toggleColorblind() {
    const body = document.body;
    const checkbox = document.getElementById("cbToggle");
    body.classList.toggle("high-contrast-mode");

    const isEnabled = body.classList.contains("high-contrast-mode");
    checkbox.checked = isEnabled;
    localStorage.setItem("colorblindMode", isEnabled);
  }

  document.addEventListener("DOMContentLoaded", () => {
    const isEnabled = localStorage.getItem("colorblindMode") === "true";
    if (isEnabled) {
      document.body.classList.add("high-contrast-mode");
      const cb = document.getElementById("cbToggle");
      if (cb) cb.checked = true;
    }
  });
</script>
